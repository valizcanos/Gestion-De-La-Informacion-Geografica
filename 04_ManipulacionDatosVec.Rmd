---
title: "03 Cargar y manipular shapes"
author: "Dr. Victor Augusto Lizcano S."
date: "2023-12-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Cargar y manipular datos vectoriales tipo .shp

Para esta sección vamos a emplear datos de áreas político administrativas globales de <a hef="https://gadm.org/">GADM</a>. Descargaremos el mapa de todas las divisiones políticos administrativas (Pais, Departamentos y Municipios) de Colombia.

```{r}
library(raster) #Empleamos la librería raster y la función shapefile
ruta = "col/" #Asigno la ruta en donde estan mis .shp}

mapaCol = shapefile(paste(ruta,"gadm41_COL_0.shp",sep=""))
plot(mapaCol, axes=TRUE)

#Ahora miremos la información de nuestro archivo

str(mapaCol)

#Revisemos el mapa con sus departamentos

mapaDpto = shapefile(paste(ruta,"gadm41_COL_1.shp",sep=""))
plot(mapaDpto, axes=TRUE)

str(mapaDpto)

# Podemos observar que el shape de los departamentos es una lista con 5 sets de datos como: "data", "polygons", "plotOrder", "bbox" y "proj4String"

#Miremos en "data" que tenemos

mapaDpto@data

#Dentro de "data" tenemos la variable "NAME_1" la cual contiene el nombre de los departamentos. Pidamosle a R que nos muestre los nombres de los departamentos.

mapaDpto@data[["NAME_1"]]

#En este caso "Bogotá D.C." corresponde a la posición 5.

mapaDpto@data[["NAME_1"]][[5]]

#Miremos como se puede graficar ese poligono

mapaDpto[mapaDpto@data[["NAME_1"]]=="Bogotá D.C.",]

plot(mapaDpto[mapaDpto@data[["NAME_1"]]=="Bogotá D.C.",], axes=TRUE)

# Ahora agreguemos otros departamentos

plot(mapaDpto[mapaDpto@data[["NAME_1"]]=="Bogotá D.C.",], axes=TRUE)
plot(mapaDpto[mapaDpto@data[["NAME_1"]]=="Cundinamarca",], add=TRUE)
plot(mapaDpto[mapaDpto@data[["NAME_1"]]=="Boyacá",], add=TRUE)
text(mapaDpto, "NAME_1")

# Por ultimo revisemos los municipios

mapaMpio = shapefile(paste(ruta,"gadm41_COL_2.shp",sep=""))
plot(mapaMpio, axes=TRUE)

#Exploremos el municipio del Tabio
plot(mapaMpio[mapaMpio@data[["NAME_2"]]=="Tabio",],axes=TRUE)
text(mapaMpio, "NAME_2")

```

### Edición de mapas

En esta sección vamos a ver algunas formas de editar nuestros mapas empleando las librerías "ggplot2" y "ggspatial"

```{r}
library("ggspatial")
library("ggplot2")

ggplot(data = mapaMpio) +
    geom_sf() +
    annotation_scale(location = "bl", width_hint = 0.5) +
    annotation_north_arrow(location = "bl", which_north = "true", 
        pad_x =unit(0.75, "in"), pad_y = unit(0.75, "in"),
        style = north_arrow_fancy_orienteering) 
```